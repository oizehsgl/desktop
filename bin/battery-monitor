#!/bin/bash

for i in 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4 3 2 1
do
    data=$(acpi -b | head -1 | awk -F'[,:%]' '{print $2, $3}')
    read -r status capacity <<<"$data"
	if [ "$status" = Discharging -a "$capacity" -lt 5 ]; then
        TITLE="Battery Empty"
        DESCRIPTION="Hibernate after $i seconds ..."
        if [ "$DISPLAY" != "" ]; then
            notify-send -u critical -t 1000 -i battery-empty "$TITLE" "$DESCRIPTION"
        else
            echo "${TITLE}, ${DESCRIPTION}" >/dev/stderr
        fi
        sleep 1
        continue
    fi
	if [ "$status" = Discharging -a "$capacity" -lt 15 ]; then
        TITLE="Battery Low"
        DESCRIPTION="Please charging"
        if [ "$DISPLAY" != "" ]; then
            notify-send -u critical -t 10000 -i battery-low "$TITLE" "$DESCRIPTION"
        else
            echo "${TITLE}, ${DESCRIPTION}" >/dev/stderr
        fi
	fi
    exit 0
done

if [ "$DISPLAY" != "" ]; then
    ~/bin/desktop-lock &
    sleep 1
fi

systemctl hibernate
